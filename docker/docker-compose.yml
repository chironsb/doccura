version: '3.8'

services:
  chroma:
    image: chromadb/chroma:latest
    container_name: doccura-chroma
    ports:
      - "8000:8000"
    volumes:
      - ../data/chroma:/chroma/chroma
    environment:
      - IS_PERSISTENT=TRUE
      - PERSIST_DIRECTORY=/chroma/chroma
    restart: unless-stopped

  doccura-mcp:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: doccura-mcp
    volumes:
      - ../data:/app/data
    depends_on:
      - chroma
    environment:
      - OLLAMA_ENDPOINT=${OLLAMA_ENDPOINT:-http://host.docker.internal:11434}
      - OLLAMA_MODEL=${OLLAMA_MODEL:-qwen3:1.7b}
      - ENABLE_THINKING=${ENABLE_THINKING:-false}
      - RAG_CHUNK_SIZE=${RAG_CHUNK_SIZE:-1000}
      - RAG_CHUNK_OVERLAP=${RAG_CHUNK_OVERLAP:-200}
      - RAG_MAX_RESULTS=${RAG_MAX_RESULTS:-5}
      - RAG_SIMILARITY_THRESHOLD=${RAG_SIMILARITY_THRESHOLD:-0.3}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL:-Xenova/paraphrase-multilingual-MiniLM-L12-v2}
      - CHROMA_URL=${CHROMA_URL:-http://chroma:8000}
      - CHROMA_PATH=${CHROMA_PATH:-./data/chroma}
      - DOCUMENTS_PATH=${DOCUMENTS_PATH:-./data/documents}
      - EMBEDDINGS_CACHE_PATH=${EMBEDDINGS_CACHE_PATH:-./data/embeddings}
      - MAX_FILE_SIZE_MB=${MAX_FILE_SIZE_MB:-50}
    stdin_open: true
    tty: true
    restart: unless-stopped

